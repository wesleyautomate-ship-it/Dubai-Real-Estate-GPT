version: "3.9"

services:
  api:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8787:8787"
    environment:
      API_HOST: 0.0.0.0
      API_PORT: 8787
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
      SUPABASE_DB_URL: ${SUPABASE_DB_URL}
      LLM_PROVIDER: ${LLM_PROVIDER:-openai}
      OPENAI_API_KEY: ${OPENAI_API_KEY}
      OPENAI_CHAT_MODEL: ${OPENAI_CHAT_MODEL:-gpt-4o-mini}
      GEMINI_API_KEY: ${GEMINI_API_KEY}
      GEMINI_CHAT_MODEL: ${GEMINI_CHAT_MODEL:-gemini-1.5-flash}
      LOG_LEVEL: ${LOG_LEVEL:-INFO}
      LOG_JSON: ${LOG_JSON:-true}
      METRICS_ENABLED: ${METRICS_ENABLED:-true}
      METRICS_ENDPOINT: ${METRICS_ENDPOINT:-/metrics}
      OTEL_ENABLED: ${OTEL_ENABLED:-false}
      OTEL_EXPORTER_OTLP_ENDPOINT: ${OTEL_EXPORTER_OTLP_ENDPOINT:-}
      OTEL_SERVICE_NAME: ${OTEL_SERVICE_NAME:-dubai-real-estate-api}
    env_file:
      - .env
    command: ["uvicorn", "backend.main:app", "--host", "0.0.0.0", "--port", "8787"]
